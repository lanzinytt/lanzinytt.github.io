---
layout:     post
title:      "äºŒåˆ†å›¾åŒ¹é…é—®é¢˜.25"
subtitle:   " \"algorithm learning\""
date:       2025-06-03 13:00:00
author:     "LanZinYtt"
header-img: "img/in-post/Bi-graph_match/BiGraph_match_header.jpg"
catalog: true
tags:
    - Algorithm Basic
---

<p id = "build"></p>

>æœ¬ä¸“é¢˜ç€é‡åˆ†æäºŒåˆ†å›¾åŒ¹é…ç®—æ³•ï¼Œå›¾æºå‚è€ƒ[OiWiki](https://oi-wiki.org/graph/graph-matching/bigraph-match)

# äºŒåˆ†å›¾åŒ¹é…é—®é¢˜

## äºŒåˆ†å›¾

- å®šä¹‰ï¼šèŠ‚ç‚¹ç”±ä¸¤ä¸ªé›†åˆç»„æˆï¼Œä¸”ä¸¤ä¸ªé›†åˆå†…éƒ¨æ²¡æœ‰è¾¹çš„å›¾
![äºŒåˆ†å›¾ç¤ºä¾‹](/img/in-post/Bi-graph_match/bi-graph.svg)
- æ€§è´¨ï¼š
    - ä¸å­˜åœ¨é•¿åº¦ä¸ºå¥‡æ•°çš„ç¯
    - å¦‚æœç”¨é»‘ç™½äº¤å‰æŸ“è‰²èŠ‚ç‚¹ï¼ŒäºŒåˆ†å›¾ä¸­æ¯ä¸€æ¡è¾¹çš„ä¸¤è¾¹ä¸€å®šæ˜¯ä¸€é»‘ä¸€ç™½
- åˆ¤å®šï¼šæ— å‘å›¾G=<V,E>ä¸ºå¶å›¾(äºŒåˆ†å›¾)çš„å……è¦æ¡ä»¶æ˜¯Gçš„æ‰€æœ‰å›è·¯çš„é•¿åº¦å‡ä¸ºå¶æ•°ã€‚
    - å¯¹äºè¿™æ ·çš„å……è¦æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å–å®ƒçš„é€†å¦å‘½é¢˜æ¥é«˜æ•ˆå¾—è¯æ˜ï¼Œä¸‹åˆ—æˆ‘ä»¬ä½¿ç”¨DFSéå†æ¥åˆ¤æ–­
   
    ```cpp
   
        class BiGraph{
        private:
            vector<vector<int>> graph;  //é‚»æ¥è¡¨
            vector<int> depth;
            vector<bool> visited;
            int n;  //èŠ‚ç‚¹æ•°

            bool dfs(int u,int p,int d){
                visited[u]=true;
                depth[u]=d;
                for(int v:graph[u]){
                    if(v==p)continue;   //é¿å…å›å¤´
                    if(!visited[v]){
                        if(dfs(v,u,d+1))return true;
                    }else{
                        if((d-depth[v]+1)%2==1)return true;//å½¢æˆå¥‡æ•°å›è·¯
                    }
                }
                return false; 
            }
        public:
            BiGraph(...){...}
            
            bool is_BiGraph(){
                visited.assign(n,false);
                depth.assign(n,-1);
                for(int i=0;i<n;i++){
                    if(!visited[i]){
                        if(dfs(i,-1,0))return false;
                    }
                }
                return true; //æ˜¯äºŒåˆ†å›¾
            }
        }
   
    ```

## äºŒåˆ†å›¾åŒ¹é…é—®é¢˜

### æœ€å¤§åŒ¹é…
- **å¢å¹¿è·¯ç®—æ³•**(O(nm))
   - å¢å¹¿è·¯ç®—æ³•çš„æ€æƒ³æ¥æºäºè¿™æ ·ä¸€ç§æƒ…å†µï¼šå½“å­˜åœ¨ä»ä¸€ä¸ªæœªåŒ¹é…ç‚¹å¼€å§‹ï¼Œä»¥å¦ä¸€ä¸ªæœªåŒ¹é…ç‚¹ç»“æŸçš„é€šè·¯ï¼Œä¸”è·¯å¾„ä¸Šçš„è¾¹äº¤æ›¿ä¸ºéåŒ¹é…è¾¹å’ŒåŒ¹é…è¾¹ï¼Œé‚£ä¹ˆï¼Œå°†è·¯å¾„ä¸Šçš„å„ä¸ªè¾¹éåŒ¹é…å’ŒåŒ¹é…æ€§è´¨è°ƒæ¢ï¼Œå¯ä»¥ä½¿å¾—åŒ¹é…è¾¹æ•°åŠ ä¸€ã€‚
   - ä¸æ–­åœ°è¿›è¡Œå¢å¹¿è·¯æ£€æµ‹ï¼Œå³å¯æ‰¾åˆ°æœ€å¤§åŒ¹é…ã€‚
   - è¿™ç‚¹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨dfsè¿›è¡Œæ£€æµ‹ä¸æ›´æ–°ã€‚
   - æˆ‘ä»¬è¯•ç€å¯¹è¿™ä¸ªæƒ³æ³•è¿›è¡Œä¼˜åŒ–ï¼Œè®©å®ƒæ›´æ˜“äºç¼–å†™ï¼šä¸éš¾å‘ç°å¢å¹¿è·¯é•¿åº¦ä¸€å®šæ˜¯å¥‡æ•°ï¼Œå¹¶ä¸”è·¯å¾„åŒ¹é…è¾¹å’ŒéåŒ¹é…è¾¹åœ¨åŒä¸€æ¬¡éå†ä¸­æ–¹å‘æ˜¯ç›¸åŒçš„ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç»™äºŒåˆ†å›¾**å®šå‘**ä¸ºæœ‰å‘å›¾ï¼Œå¯ä»¥æ›´å®¹æ˜“çš„è¿›è¡Œdfsã€‚
   
    ```cpp

    struct augment_path{
        vector<set<int>> g;
        vector<int> pa,pb,vis;
        int n,m,dfn,res;
        augment_path(int _n,int _m):n(_n),m(_m){
            assert(0<=n && 0<=m);
            pa.assign(n,-1);
            pb.assign(m,-1);
            vis.assign(n,-1);
            g.resize(n);
            res=0;
            dfn=0;
        }
        void add(int u,int to){
            assert(0<=u && u<n && 0<=to && to<m);   //æ–­è¨€
            g[u].insert(to);
        }
        bool dfs(int v){
            vis[v]=dfn;
            for(int u:g[v]){
                if(pb[u]==-1){
                    pb[u]=v;
                    pa[v]=u;
                    return true;
                }
            }
            for(int u:g[v]){
                if(vis[pb[u]]!=dfn && dfs(pb[u])){
                    pa[v]=u;
                    pb[u]=v;
                    return true;
                }
            }
            return false;
        }
        int solve(){
            while (true){
                dfn++;  //è¡¨ç¤ºè½®æ•°
                int cnt=0;
                for(int i=0;i<n;i++){
                    if(pa[i]==-1 && dfs(i)){
                        cnt++;
                    }
                }
                if(cnt==0){
                    break;
                }
                res+=cnt;
            }
            return res;
        }
    };

    ```
- **æœ€å°ç‚¹è¦†ç›–**

    - å®šä¹‰ï¼šåœ¨äºŒåˆ†å›¾ä¸­é€‰å‡ºæœ€å°‘çš„ç‚¹ï¼Œæ»¡è¶³æ¯æ¡è¾¹è‡³å°‘æœ‰ä¸€ä¸ªç«¯ç‚¹è¢«é€‰ã€‚
    - å¯ä»¥è¯æ˜ï¼Œåœ¨äºŒåˆ†å›¾ä¸­ï¼Œæœ€å°ç‚¹è¦†ç›–=æœ€å¤§åŒ¹é…
    - è¯æ˜:å®¹æ˜“æƒ³åˆ°ï¼Œåœ¨æœ€å¤§åŒ¹é…ä¸­è‹¥æœ‰kæ¡è¾¹ï¼Œè¦è¦†ç›–è¿™kæ¡è¾¹ï¼Œèµ·ç è¦æœ‰kä¸ªç‚¹ï¼Œæœ‰æœ€å°ç‚¹è¦†ç›–â‰¥æœ€å¤§åŒ¹é…ï¼Œè¿™ç‚¹æ˜¯æ˜¾ç„¶çš„ã€‚ç„¶è€Œä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ç›¸ç­‰ï¼Œå¹¶ä¸å¥½æƒ³ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªç‚¹è¦†ç›–ã€‚å¯¹äºå·¦ä¾§é›†åˆAä¸å³ä¾§é›†åˆBï¼Œè®¾ç”¨DFSå¯è¾¾çš„å·¦ä¾§ç‚¹é›†åˆä¸ºSï¼Œå³ä¾§ç‚¹é›†åˆä¸ºTï¼Œ(A-S) âˆª Tï¼Œå¯¹äºè¿æ¥Så’ŒTçš„è¾¹(è¢«Tè¦†ç›–)ã€å¯¹äºè¿æ¥Så’Œ(B-T)çš„è¾¹(ä¸å­˜åœ¨)ã€å¯¹äºè¿æ¥A-Så’ŒTçš„è¾¹(è¢«A-Sä¸­è¦†ç›–)ã€å¯¹äºè¿æ¥A-Så’ŒB-Tçš„è¾¹(è¢«A-Sè¦†ç›–)ï¼Œå®¹æ˜“è§‚å¯ŸçŸ¥è¿™ä¸ªç‚¹è¦†ç›–çš„å¤§å°ç­‰äºæœ€å¤§åŒ¹é…ã€‚[KÃ¶nigå®šç†]
- è¿™é‡Œæœ€å¤§åŒ¹é…å®é™…ä¸Šä¹Ÿå¯ä»¥è½¬ä¸ºç½‘ç»œæµé—®é¢˜ï¼Œä½†é„™äººç½‘ç»œæµäº†è§£ä¸å¤šï¼Œå¯ä»¥å‰å¾€[OiWiki](https://oi-wiki.org/graph/flow/max-flow/#dinic-%E7%AE%97%E6%B3%95)æŸ¥é˜…

### æœ€å¤§æƒåŒ¹é…

- [**åŒˆç‰™åˆ©ç®—æ³•**(Hungarian Algorithm)](https://oi-wiki.org/graph/graph-matching/bigraph-weight-match/)
    - è¿™ä¸ªç®—æ³•çš„é€»è¾‘ç›¸å½“å¤æ‚ï¼Œå¯¹äºæƒ³è¦æ·±ç©¶çš„åŒå­¦éå¸¸å»ºè®®è¯»ä¸€ä¸‹[åŸè®ºæ–‡](https://onlinelibrary.wiley.com/doi/abs/10.1002/nav.3800020109)ã€‚å¦å¤–ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„ç½‘ç«™ç›´æ¥[æ¼”ç¤ºåŒˆç‰™åˆ©ç®—æ³•çš„è®¡ç®—è¿‡ç¨‹](https://www.hungarianalgorithm.com/hungarianalgorithm.php)ï¼Œåœ¨æ­¤æˆ‘åªåšéƒ¨åˆ†æˆ‘å¯¹åŸç†çš„ç†è§£ã€‚
    - å…³é”®æ¦‚å¿µ:
        - é¡¶æ ‡ï¼šç»™æ¯ä¸ªé¡¶ç‚¹åˆ†é…æ•°å€¼æ ‡ç­¾ï¼Œå·¦ä¾§é¡¶ç‚¹æ ‡ç­¾`lx[i]`ï¼Œå³ä¾§é¡¶ç‚¹æ ‡ç­¾`ly[j]`
        - å¯è¡Œé¡¶æ ‡ï¼šæ»¡è¶³`lx[i] + ly[j] â‰¥ w[i][j]`å¯¹æ‰€æœ‰è¾¹æˆç«‹
        - ç›¸ç­‰å­å›¾ï¼šåªåŒ…å«æ»¡è¶³`lx[i] + ly[j] = w[i][j]`çš„è¾¹çš„å­å›¾
        - 
    - åŸç†è§£æï¼š
        - å¿…é¡»è¦è¯´æ˜çš„æ˜¯ï¼ŒåŒˆç‰™åˆ©åŒ¹é…éœ€è¦å¶å›¾ä¸¤ä¸ªé›†åˆä¸­ç‚¹æ•°ç›¸ç­‰ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸å­˜åœ¨çš„è¾¹è¡¥0ï¼Œç„¶åå†è¿›è¡Œç®—æ³•æµç¨‹å³å¯ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥ä»£ç ä¸­å¸¸ç”¨çš„é¡¶æ ‡å½¢å¼ä¸¾ä¾‹ã€‚
        - é¦–å…ˆæˆ‘ä»¬è¯æ˜ä¸€ä¸ªå‰ç½®å®šç†ä¸€ï¼šå¯¹äºæŸç»„å¯è¡Œé¡¶æ ‡ï¼Œå¦‚æœå…¶ç›¸ç­‰å­å›¾å­˜åœ¨å®Œå…¨åŒ¹é…ï¼Œé‚£ä¹ˆï¼Œè¯¥åŒ¹é…å°±æ˜¯åŸäºŒåˆ†å›¾çš„æœ€å¤§æƒå®Œå…¨åŒ¹é…
        - ä¸éš¾è¯æ˜ï¼Œå¯¹äºä»»ä½•åŒ¹é…ï¼Œå…¶æƒé‡å°äºæ‰€æœ‰é¡¶æ ‡å’Œï¼Œè€Œå¦‚æœå­˜åœ¨ä¸€ç»„åŒ¹é…ä½¿å¾—åœ¨ç›¸ç­‰å­å›¾ä¸­æ˜¯å®Œå…¨åŒ¹é…ï¼Œåˆ™æ»¡è¶³ä¸Šç•Œå–ç­‰
        - æˆ‘ä»¬å¯ä»¥å…ˆå¯¹åŸå›¾åˆå§‹åŒ–ä¸€ç»„å¯è¡Œé¡¶æ ‡ï¼Œä¾‹å¦‚$lx(i) = \max_{1\leq j\leq n} \{ w(i, j)\},\, ly(i) = 0$
        - ç„¶åé€‰ä¸€ä¸ªæœªåŒ¹é…ç‚¹ï¼Œå¦‚åŒæœ€å¤§åŒ¹é…ä¸€æ ·æ±‚å¢å¹¿è·¯ã€‚æ‰¾åˆ°å¢å¹¿è·¯å°±å¢å¹¿ï¼Œå¦åˆ™ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªäº¤é”™æ ‘ï¼Œåˆ™éœ€è¦å›æº¯æˆ–è€…ç»“æŸå½“è½®æœç´¢ã€‚
        - ä»¤ Sï¼ŒT è¡¨ç¤ºäºŒåˆ†å›¾å·¦è¾¹å³è¾¹åœ¨äº¤é”™æ ‘ä¸­çš„ç‚¹ï¼ŒS'ï¼ŒT' è¡¨ç¤ºä¸åœ¨äº¤é”™æ ‘ä¸­çš„ç‚¹ã€‚
        - åœ¨ç›¸ç­‰å­å›¾ä¸­ï¼š
            - S-T' çš„è¾¹ä¸å­˜åœ¨ï¼Œå¦åˆ™äº¤é”™æ ‘ä¼šå¢é•¿ã€‚
            - S'-T ä¸€å®šæ˜¯éåŒ¹é…è¾¹ï¼Œå¦åˆ™ä»–å°±å±äº Sã€‚
        - å‡è®¾ç»™ S ä¸­çš„é¡¶æ ‡ -aï¼Œç»™ T ä¸­çš„é¡¶æ ‡ +aï¼Œå¯ä»¥å‘ç°
            - S-T è¾¹ä¾ç„¶å­˜åœ¨ç›¸ç­‰å­å›¾ä¸­ã€‚
            - S'-T' æ²¡å˜åŒ–ã€‚
            - S-T' ä¸­çš„ lx + ly æœ‰æ‰€å‡å°‘ï¼Œå¯èƒ½åŠ å…¥ç›¸ç­‰å­å›¾ã€‚
            - S'-T ä¸­çš„ lx + ly ä¼šå¢åŠ ï¼Œæ‰€ä»¥ä¸å¯èƒ½åŠ å…¥ç›¸ç­‰å­å›¾ã€‚
        - æœªæ¥æœ€å°åŒ–é¡¶æ ‡è°ƒæ•´çš„å¹…åº¦ï¼ŒåŒæ—¶ç¡®ä¿è‡³å°‘æœ‰ä¸€æ¡æ–°è¾¹èƒ½è¿›å…¥ç›¸ç­‰å­å›¾ï¼Œaå¾—æ˜¯ S-T'å½“ä¸­æœ€å°çš„è¾¹æƒ
        $a =\min\{ lx(u) + ly(v) - w(u,v) | u\in{S} , v\in{T'}\}$
        - å½“ä¸€æ¡æ–°çš„è¾¹ (u,v) åŠ å…¥ç›¸ç­‰å­å›¾åæœ‰ä¸¤ç§æƒ…å†µ
            - v æ˜¯æœªåŒ¹é…ç‚¹ï¼Œåˆ™æ‰¾åˆ°å¢å¹¿è·¯
            - v å’Œ S' ä¸­çš„ç‚¹å·²ç»åŒ¹é…
        - è¿™æ ·è‡³å¤šä¿®æ”¹ n æ¬¡é¡¶æ ‡åï¼Œå°±å¯ä»¥æ‰¾åˆ°å¢å¹¿è·¯ã€‚
        - è¿™æ ·å¾—åˆ°çš„ç›¸ç­‰å­å›¾ä¸­çš„å®Œå…¨åŒ¹é…ï¼Œæ ¹æ®å®šç†ä¸€å¯ä»¥å¾—çŸ¥å®ƒå°±ç®—æœ€å¤§æƒå®Œå…¨åŒ¹é…ã€‚
    - ä»¥ä¸Šæ˜¯é¡¶æ ‡å½¢å¼çš„é€»è¾‘ï¼Œ[çŸ©é˜µå½¢å¼](https://zhuanlan.zhihu.com/p/677501913)å®è´¨ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œç›®çš„éƒ½æ˜¯ä¸ºäº†è®©æ›´å¤šçš„è¾¹è¿›å…¥ç›¸ç­‰å­å›¾ä¸­ã€‚
    - ä»£ç å®ç°(è¿™é‡Œç”¨çš„æ˜¯ç®€çŸ­çš„ï¼Œè€Œä¸”æ•ˆç‡ä¸ç®—å¾ˆé«˜çš„ï¼Œå¦‚æœæƒ³è¦æ›´å®ç”¨çš„æ¿å­å¯ä»¥å‚è€ƒ[OiWiki](https://oi-wiki.org/graph/graph-matching/bigraph-weight-match/))ï¼š

    ```cpp
    
        struct KM {
            int n;
            vector<vector<int>> w;
            vector<int> lx, ly, match;
            vector<bool> vx, vy;
            vector<int> slack;

            KM(int n) : n(n), w(n, vector<int>(n, 0)), 
                    lx(n), ly(n), match(n, -1), 
                    vx(n), vy(n), slack(n) {}
            
            bool dfs(int u) {
                vx[u] = true;
                for (int v = 0; v < n; v++) {
                    if (vy[v]) continue;
                    int d = lx[u] + ly[v] - w[u][v];
                    if (d == 0) {
                        vy[v] = true;
                        if (match[v] == -1 || dfs(match[v])) {
                            match[v] = u;
                            return true;
                        }
                    } else if (slack[v] > d) {
                        slack[v] = d;
                    }
                }
                return false;
            }
            
            int solve() {
                // åˆå§‹åŒ–é¡¶æ ‡
                for (int i = 0; i < n; i++)
                    lx[i] = *max_element(w[i].begin(), w[i].end());
                    
                for (int i = 0; i < n; i++) {
                    fill(slack.begin(), slack.end(), INT_MAX);
                    while (true) {
                        fill(vx.begin(), vx.end(), false);
                        fill(vy.begin(), vy.end(), false);
                        if (dfs(i)) break;
                        
                        // è°ƒæ•´é¡¶æ ‡
                        int d = *min_element(slack.begin(), slack.end());
                        for (int j = 0; j < n; j++) {
                            if (vx[j]) lx[j] -= d;
                            if (vy[j]) ly[j] += d;
                            else slack[j] -= d;
                        }
                        fill(slack.begin(), slack.end(), INT_MAX);
                    }
                }
                
                int res = 0;
                for (int i = 0; i < n; i++)
                    if (match[i] != -1 && w[match[i]][i] > 0) // åªç»Ÿè®¡å®é™…å­˜åœ¨çš„è¾¹
                        res += w[match[i]][i];
                return res;
            }
        };
    
    ```

æ ·é¢˜ï¼š[CDOJå¾½ç« å•†åº—(æœ€å°è¦†ç›–)[å¯èƒ½æœªå…¬å¼€]](https://cdoj.site/d/presummer_training_2025/p/P1085?tid=6817867c385b3643f32598b3)ã€[UOJ80(æœ€å¤§æƒåŒ¹é…)](https://uoj.ac/problem/80)

è‡³æ­¤ï¼Œå¸Œæœ›ä½ èƒ½ç†è§£äºŒåˆ†å›¾ä¸­çš„å„ä¸ªæ¦‚å¿µğŸ˜˜